# √âtat Actuel du Projet "Aether Drive V1"

## 1. D√©p√¥t et Configuration
* **Nom du D√©p√¥t** : nathanpetruzzellis/aether-drive
* **Statut Git** : Squelette Tauri/React initialis√©.
* **Environnement IDE** : Cursor, Terminal (zsh).
* **R√®gles IA** : Fichiers de contexte en place.

## 2. √âtat Technique
* **Phase de D√©veloppement** : PHASE 3 COMPL√àTE + Storj Transparent + Refresh Tokens ‚Äî Int√©gration Wayne (Control Plane) + HTTPS op√©rationnel + Storj g√©r√© automatiquement par Wayne + Refresh tokens avec option "Rester connect√©" + Gestion des conflits de base de donn√©es.
* **Travail Effectu√©** : D√©p√¥t configur√©, stack Tauri (React + Rust) initialis√©e, d√©pendances crypto ajout√©es, module `crypto` (Argon2id ‚Üí MasterKey ‚Üí FileKey ‚Üí MKEK) impl√©ment√© et couvert par des tests unitaires, commandes Tauri expos√©es et flux React local (bootstrap/unlock) op√©rationnel avec persistance des donn√©es du bootstrap via localStorage, contrat d'API Wayne d√©fini (DTO + client HTTP minimal), module SQLCipher impl√©ment√© (`SqlCipherIndex`) avec d√©rivation de cl√© via HKDF depuis la MasterKey et tests unitaires valid√©s, int√©gration SQLCipher dans le flux applicatif termin√©e (base cr√©√©e/ouverte automatiquement lors du bootstrap/unlock dans le r√©pertoire de donn√©es de l'app), persistance des donn√©es du bootstrap impl√©ment√©e (localStorage) permettant le d√©verrouillage apr√®s red√©marrage de l'app, commandes Tauri pour manipuler l'index impl√©ment√©es et test√©es (`index_add_file`, `index_list_files`, `index_remove_file`, `index_get_file`) avec interface React fonctionnelle permettant l'ajout, la liste et la suppression de fichiers dans l'index SQLCipher, module `storage` impl√©ment√© avec format de fichier "Aether" V1 (en-t√™te binaire avec Magic Number `AETH`, Version `0x01`, Cipher ID `0x02`, UUID, Salt, Commitment HMAC, Nonce) et fonctions de chiffrement/d√©chiffrement avec XChaCha20-Poly1305 utilisant FileKey d√©riv√©e via HKDF depuis MasterKey, AAD incluant le chemin logique pour protection contre d√©placement/renommage, s√©rialisation/d√©s√©rialisation binaire et tests unitaires valid√©s (12/12 tests passent), commandes Tauri expos√©es pour le chiffrement/d√©chiffrement (`storage_encrypt_file`, `storage_decrypt_file`, `storage_get_file_info`) avec interface React fonctionnelle permettant de tester le format Aether de mani√®re interactive (chiffrement de texte, affichage des m√©tadonn√©es, d√©chiffrement avec v√©rification du chemin logique), **PHASE 1 FINALIS√âE** : protection HMAC pour chaque entr√©e de l'index SQLCipher (HMAC-SHA256 calcul√© et v√©rifi√© lors de chaque op√©ration), module Merkle Tree impl√©ment√© pour v√©rification de l'int√©grit√© globale de l'index (hash Merkle calcul√© et stock√© automatiquement lors des modifications, v√©rification disponible via `verify_integrity()`), commande Tauri `index_verify_integrity` expos√©e pour v√©rifier l'int√©grit√© depuis l'interface React, migration automatique du sch√©ma SQLCipher pour ajouter le champ HMAC aux bases existantes, tous les tests unitaires passent (18/18 tests), **PHASE 2 FINALIS√âE** : module `storj` impl√©ment√© avec client Storj DCS utilisant `aws-sdk-s3` (configuration, upload, download, delete, list), commandes Tauri expos√©es pour l'int√©gration Storj (`storj_configure`, `storj_upload_file`, `storj_download_file`, `storj_download_file_by_path`, `storj_list_files`, `storj_delete_file`), synchronisation automatique entre Storj et l'index local SQLCipher (ajout automatique dans l'index apr√®s upload Storj, suppression automatique de l'index apr√®s suppression Storj, nettoyage automatique des fichiers orphelins), normalisation des UUIDs pour correspondance entre Storj et index local, gestion des fichiers non-Aether (ignor√©s avec avertissement), interface React compl√®te pour la gestion Storj (configuration, upload, download par chemin logique ou UUID, liste avec m√©tadonn√©es, suppression), ajout automatique des fichiers chiffr√©s √† l'index local apr√®s chiffrement, tous les tests int√©graux Phase 1 + Phase 2 valid√©s √† 100% (workflow end-to-end, non-r√©gression, persistance apr√®s red√©marrage), **PHASE 3 FINALIS√âE** : serveur Wayne (Node.js/TypeScript + PostgreSQL) cr√©√© et d√©ploy√© sur VPS (72.62.59.152), sch√©ma de base de donn√©es PostgreSQL cr√©√© (users, key_envelopes, refresh_tokens), API REST op√©rationnelle (authentification, gestion des enveloppes MKEK), service systemd configur√© et actif, Nginx configur√© comme reverse proxy (port 80), serveur accessible publiquement via HTTP, client Wayne int√©gr√© dans l'application React (authentification, sauvegarde/r√©cup√©ration MKEK), tous les tests d'int√©gration end-to-end valid√©s (bootstrap avec sauvegarde MKEK sur Wayne, unlock avec r√©cup√©ration MKEK depuis Wayne, non-r√©gression Phase 1 et Phase 2).
* **Travail Effectu√© (Storj Transparent)** : Migration Wayne ajoutant table `storj_buckets` pour stockage credentials chiffr√©s, service Storj cr√©√© pour cr√©ation automatique de buckets Storj par utilisateur, API Wayne avec endpoints `/api/v1/storj-config` pour cr√©er/r√©cup√©rer config Storj automatiquement, cr√©ation automatique de bucket Storj lors de l'inscription Wayne, client React int√©grant r√©cup√©ration et configuration automatique Storj depuis Wayne, Dashboard simplifi√© avec suppression section Configuration Storj (g√©r√© automatiquement), chiffrement credentials Storj avec cl√© ma√Ætre serveur, workflow simplifi√© √† 2 √©tapes seulement (Wayne + Mot de passe ma√Ætre), Storj compl√®tement transparent pour l'utilisateur final.
* **Travail Effectu√© (Refresh Tokens)** : Mod√®le RefreshToken cr√©√© avec g√©n√©ration s√©curis√©e (crypto.randomBytes, bcrypt), API Wayne avec endpoints `/api/v1/auth/refresh` et `/api/v1/auth/logout`, int√©gration dans `/login` et `/register` avec param√®tre `remember_me` optionnel, client React avec stockage localStorage, restauration automatique de session au d√©marrage, option "Rester connect√©" dans LoginPage avec checkbox, gestion des conflits de base de donn√©es avec commande `reset_local_database` et bouton de r√©solution dans l'interface.
* **Travail Effectu√© (UX Simplifi√©e)** : Refactorisation compl√®te du Dashboard pour une exp√©rience utilisateur simplifi√©e similaire aux services cloud (Google Drive, Dropbox), upload simplifi√© avec s√©lection de fichier via zone d√©di√©e (drag & drop temporairement d√©sactiv√© - limitation Tauri 2.0), suppression compl√®te des sections Storj et Index manuelles (gestion 100% automatique en arri√®re-plan), tableau de fichiers moderne avec colonnes (ic√¥ne type, nom avec extension, taille format√©e, actions), actions simplifi√©es (ic√¥nes download/delete √† c√¥t√© de chaque fichier), chargement automatique des fichiers depuis Storj au montage (synchronisation transparente), chemin logique auto-g√©n√©r√© depuis le nom du fichier (plus besoin de saisie manuelle), workflow simplifi√© √† 2 actions seulement (upload via s√©lection de fichier, download/delete via ic√¥nes), interface √©pur√©e et professionnelle avec animations et √©tats de chargement, commande Tauri `select_and_read_file_from_path` pour lecture de fichiers depuis chemin syst√®me.
* **Travail Effectu√© (Recherche, Tri et Filtrage)** : Barre de recherche en temps r√©el pour filtrer les fichiers par nom avec bouton d'effacement, tri des fichiers par nom (A-Z, Z-A) et par taille (croissant, d√©croissant) avec s√©lecteur de champ et bouton d'ordre, filtrage par type de fichier (Tous, Images, Documents, Vid√©os, Audio, Archives, Autres) avec cat√©gorisation automatique par extension, interface de contr√¥les int√©gr√©e au-dessus du tableau avec compteur de r√©sultats, message d'√©tat vide si aucun r√©sultat, bouton de r√©initialisation des filtres, styles adapt√©s pour mode clair/sombre, filtrage combin√© (recherche + type) avec tri persistant, calculs c√¥t√© client sans rechargement.
* **Travail Effectu√© (Robustesse et Gestion d'Erreurs)** : Utilitaire de retry avec backoff exponentiel (`src/utils/retry.ts`) avec 3 tentatives par d√©faut, d√©lais exponentiels (1s, 2s, 4s, max 10s), d√©tection automatique des erreurs r√©cup√©rables (r√©seau, 5xx), support des timeouts configurables (30s par d√©faut), client Wayne am√©lior√© avec retry automatique sur toutes les requ√™tes HTTP, messages d'erreur contextuels avec suggestions selon le code HTTP (401, 403, 404, 5xx), gestion am√©lior√©e des erreurs r√©seau avec suggestions de r√©solution, Dashboard avec retry automatique pour toutes les op√©rations (chargement, upload, download, suppression), messages de progression d√©taill√©s pour chaque √©tape (lecture, chiffrement, upload, d√©chiffrement, sauvegarde), correction du bug de chargement infini du bouton Actualiser avec try/finally, am√©lioration UX avec feedback visuel et messages actionnables.
* **Travail Effectu√© (M√©tadonn√©es Anonymis√©es sur Wayne)** : Migration PostgreSQL (`002_file_metadata.sql`) pour table `file_metadata` (id, user_id, file_uuid, encrypted_size, file_type, created_at, updated_at), index pour recherche rapide, trigger `updated_at`, mod√®le `FileMetadata` sur Wayne avec m√©thodes `upsert()`, `findByUserId()`, `findByFileUuid()`, `delete()`, `deleteAllByUserId()`, `getUserStats()`, API REST (`wayne-server/src/routes/fileMetadata.ts`) pour `POST /api/v1/file-metadata`, `GET /api/v1/file-metadata`, `GET /api/v1/file-metadata/stats`, `GET /api/v1/file-metadata/:file_uuid`, `DELETE /api/v1/file-metadata/:file_uuid`, route int√©gr√©e dans `index.ts`, client Wayne (`src/wayne_client.ts` + `src/wayne_dto.ts`) avec DTOs et m√©thodes `saveFileMetadata()`, `getFileMetadata()`, `getUserStats()`, `deleteFileMetadata()`, int√©gration Dashboard (`src/pages/DashboardPage.tsx`) avec synchronisation automatique lors de l'upload (extraction UUID, sauvegarde m√©tadonn√©es), synchronisation lors de la suppression (suppression m√©tadonn√©es), affichage des statistiques dans le header (nombre de fichiers, espace utilis√©), rechargement automatique des statistiques apr√®s upload/suppression, corrections serveur (configuration `trust proxy` pour Express), correction bug upload avec try/finally pour garantir r√©initialisation de `isUploading`, serveur red√©marr√© et op√©rationnel.
* **Travail Effectu√© (Gestion des Dossiers)** : Commande Tauri `list_files_and_folders` pour lister les fichiers et dossiers dans un chemin donn√©, commande Tauri `create_folder` pour cr√©er un dossier vide, impl√©mentation de la navigation par dossiers dans le Dashboard (breadcrumb, entr√©e/sortie de dossiers), affichage des dossiers dans le tableau de fichiers avec ic√¥nes, modification de l'upload pour cibler le dossier actuel, ajout d'un bouton "Cr√©er un dossier" avec modal dans l'interface, d√©tection des dossiers vides dans `list_files_and_folders`, correction de la logique de d√©tection des dossiers (utilisation du chemin original au lieu du chemin normalis√©), correction du rechargement apr√®s upload et cr√©ation de dossier (rechargement direct depuis l'index local), tous les tests valid√©s (cr√©ation, navigation, upload dans dossier).
* **Travail Effectu√© (Renommage de Fichiers)** : Commande Tauri `rename_file` pour renommer un fichier (t√©l√©chargement depuis Storj, d√©chiffrement avec ancien chemin, re-chiffrement avec nouveau chemin dans AAD, re-upload vers Storj, suppression ancien fichier, mise √† jour index local), interface React avec bouton "Renommer" (‚úèÔ∏è) dans le tableau de fichiers, modal de saisie pour nouveau nom avec validation, gestion du renommage dans les dossiers (pr√©servation du chemin parent), synchronisation automatique apr√®s renommage (rechargement liste fichiers, mise √† jour m√©tadonn√©es Wayne), gestion des erreurs et feedback utilisateur, tous les tests valid√©s.
* **Travail Effectu√© (Menu Contextuel)** : √âtat `contextMenu` pour g√©rer la position et le fichier s√©lectionn√©, gestionnaire `onContextMenu` sur les lignes du tableau de fichiers, menu contextuel positionn√© dynamiquement √† la position du clic avec actions (Renommer, T√©l√©charger, Supprimer), overlay pour fermeture au clic, fermeture avec touche Escape, styles modernes avec ombre et transitions, tous les tests valid√©s.
* **Travail Effectu√© (Corbeille)** : Migration SQLCipher (version 3) avec table `trash` (id, logical_path, encrypted_size, deleted_at, hmac), m√©thodes `move_to_trash`, `restore_from_trash`, `list_trash`, `remove_from_trash`, `empty_trash` dans `SqlCipherIndex`, modification de `storj_delete_file` pour d√©placer vers la corbeille au lieu de supprimer d√©finitivement (le fichier reste sur Storj), commandes Tauri `list_trash`, `restore_from_trash`, `permanently_delete_from_trash`, `empty_trash`, interface React avec bouton "üóëÔ∏è Corbeille" dans le header, section corbeille avec tableau des fichiers supprim√©s (nom, taille, date de suppression), actions restaurer (‚ôªÔ∏è), supprimer d√©finitivement (üóëÔ∏è), vider la corbeille, formatage de la date de suppression (relatif ou absolu), synchronisation avec m√©tadonn√©es Wayne, correction du filtrage des pr√©fixes Storj (dossiers) dans `list_files()`, tous les tests valid√©s.
* **Travail Effectu√© (Aper√ßu de Fichiers)** : Commande Tauri `preview_file` pour t√©l√©charger et d√©chiffrer un fichier en m√©moire (sans sauvegarde), interface React avec modal d'aper√ßu plein √©cran, d√©tection automatique du type de fichier (image, texte, PDF, non support√©), support des images (PNG, JPG, GIF, WebP, SVG, BMP) avec affichage direct via Blob URL, support du texte (TXT, MD, JSON, XML, HTML, CSS, JS, TS, etc.) avec affichage dans un √©diteur monospace, support PDF avec affichage via iframe, message informatif pour les types non support√©s avec option de t√©l√©chargement, int√©gration dans le menu contextuel avec option "üëÅÔ∏è Aper√ßu", bouton d'aper√ßu (üëÅÔ∏è) dans le tableau de fichiers (colonne Actions), bouton de t√©l√©chargement dans le modal, fermeture via clic ext√©rieur ou bouton, tous les tests valid√©s.
* **Travail Effectu√© (Optimisations Performances)** : R√©duction des logs excessifs dans `storj_list_files` (suppression des logs dans les boucles), suppression de la synchronisation automatique co√ªteuse (t√©l√©chargement de tous les fichiers manquants depuis Storj remplac√© par un warning), index SQL sur `logical_path` pour acc√©l√©rer les recherches par chemin, nettoyage automatique des Blob URLs dans l'aper√ßu (useEffect + fonction closePreview), memoization React avec `useMemo` pour `filteredAndSortedFiles` (√©vite les recalculs inutiles), `useCallback` pour `loadFiles` (√©vite les recr√©ations de fonction), debounce de 300ms pour la recherche (√©vite les recherches √† chaque frappe), tous les tests valid√©s.
* **Travail Restant (Prochaine Phase)** : Tests des optimisations avec de grandes quantit√©s de fichiers, optimisations suppl√©mentaires si n√©cessaire.

## 3. Non-R√©gression
* Tests initiaux Tauri (dev server) valid√©s.
* Tests unitaires Rust du Crypto Core (`cargo test`) valid√©s.
* Flux UI local (bootstrap/unlock) test√© manuellement avec succ√®s.
* Tests unitaires SQLCipher (`cargo test sqlcipher_index`) valid√©s.
* Persistance des donn√©es du bootstrap et d√©verrouillage apr√®s red√©marrage valid√©s.
* Commandes d'index (ajout/liste/suppression) test√©es manuellement avec succ√®s.
* Module storage (format Aether) compil√© et tests unitaires valid√©s (12/12 tests passent).
* Commandes de chiffrement/d√©chiffrement test√©es manuellement avec succ√®s depuis l'interface React.
* Protection HMAC par entr√©e impl√©ment√©e et test√©e (tests unitaires passent).
* Merkle Tree pour int√©grit√© globale impl√©ment√© et test√© (tests unitaires passent).
* V√©rification d'int√©grit√© test√©e manuellement depuis l'interface React avec succ√®s.
* **PHASE 1 COMPL√àTE** : Tous les tests unitaires passent (18/18), conformit√© blueprint 100%.
* **PHASE 2 COMPL√àTE** : Int√©gration Storj DCS op√©rationnelle avec synchronisation automatique index local, tous les tests int√©graux valid√©s (configuration, upload, download, delete, nettoyage orphelins, workflow end-to-end, non-r√©gression Phase 1, persistance apr√®s red√©marrage).
* **PHASE 3 COMPL√àTE** : Serveur Wayne d√©ploy√© et accessible publiquement via HTTPS (https://eather.io), certificat SSL Let's Encrypt install√© et configur√©, base de donn√©es PostgreSQL op√©rationnelle, API REST fonctionnelle, service systemd actif, Nginx configur√© avec redirection HTTP‚ÜíHTTPS, client Wayne int√©gr√© dans l'application React avec authentification et gestion MKEK, URL par d√©faut mise √† jour pour HTTPS, gestion d'erreur r√©seau am√©lior√©e dans le client Wayne, scripts de diagnostic et configuration cr√©√©s, connexion HTTPS valid√©e et fonctionnelle, tous les tests d'int√©gration end-to-end valid√©s (bootstrap avec sauvegarde MKEK sur Wayne, unlock avec r√©cup√©ration MKEK depuis Wayne, non-r√©gression Phase 1 et Phase 2).
