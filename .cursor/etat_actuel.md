# État Actuel du Projet "Aether Drive V1"

## 1. Dépôt et Configuration
* **Nom du Dépôt** : nathanpetruzzellis/aether-drive
* **Statut Git** : Squelette Tauri/React initialisé.
* **Environnement IDE** : Cursor, Terminal (zsh).
* **Règles IA** : Fichiers de contexte en place.

## 2. État Technique
* **Phase de Développement** : PHASE 3 COMPLÈTE + Storj Transparent + Refresh Tokens — Intégration Wayne (Control Plane) + HTTPS opérationnel + Storj géré automatiquement par Wayne + Refresh tokens avec option "Rester connecté" + Gestion des conflits de base de données.
* **Travail Effectué** : Dépôt configuré, stack Tauri (React + Rust) initialisée, dépendances crypto ajoutées, module `crypto` (Argon2id → MasterKey → FileKey → MKEK) implémenté et couvert par des tests unitaires, commandes Tauri exposées et flux React local (bootstrap/unlock) opérationnel avec persistance des données du bootstrap via localStorage, contrat d'API Wayne défini (DTO + client HTTP minimal), module SQLCipher implémenté (`SqlCipherIndex`) avec dérivation de clé via HKDF depuis la MasterKey et tests unitaires validés, intégration SQLCipher dans le flux applicatif terminée (base créée/ouverte automatiquement lors du bootstrap/unlock dans le répertoire de données de l'app), persistance des données du bootstrap implémentée (localStorage) permettant le déverrouillage après redémarrage de l'app, commandes Tauri pour manipuler l'index implémentées et testées (`index_add_file`, `index_list_files`, `index_remove_file`, `index_get_file`) avec interface React fonctionnelle permettant l'ajout, la liste et la suppression de fichiers dans l'index SQLCipher, module `storage` implémenté avec format de fichier "Aether" V1 (en-tête binaire avec Magic Number `AETH`, Version `0x01`, Cipher ID `0x02`, UUID, Salt, Commitment HMAC, Nonce) et fonctions de chiffrement/déchiffrement avec XChaCha20-Poly1305 utilisant FileKey dérivée via HKDF depuis MasterKey, AAD incluant le chemin logique pour protection contre déplacement/renommage, sérialisation/désérialisation binaire et tests unitaires validés (12/12 tests passent), commandes Tauri exposées pour le chiffrement/déchiffrement (`storage_encrypt_file`, `storage_decrypt_file`, `storage_get_file_info`) avec interface React fonctionnelle permettant de tester le format Aether de manière interactive (chiffrement de texte, affichage des métadonnées, déchiffrement avec vérification du chemin logique), **PHASE 1 FINALISÉE** : protection HMAC pour chaque entrée de l'index SQLCipher (HMAC-SHA256 calculé et vérifié lors de chaque opération), module Merkle Tree implémenté pour vérification de l'intégrité globale de l'index (hash Merkle calculé et stocké automatiquement lors des modifications, vérification disponible via `verify_integrity()`), commande Tauri `index_verify_integrity` exposée pour vérifier l'intégrité depuis l'interface React, migration automatique du schéma SQLCipher pour ajouter le champ HMAC aux bases existantes, tous les tests unitaires passent (18/18 tests), **PHASE 2 FINALISÉE** : module `storj` implémenté avec client Storj DCS utilisant `aws-sdk-s3` (configuration, upload, download, delete, list), commandes Tauri exposées pour l'intégration Storj (`storj_configure`, `storj_upload_file`, `storj_download_file`, `storj_download_file_by_path`, `storj_list_files`, `storj_delete_file`), synchronisation automatique entre Storj et l'index local SQLCipher (ajout automatique dans l'index après upload Storj, suppression automatique de l'index après suppression Storj, nettoyage automatique des fichiers orphelins), normalisation des UUIDs pour correspondance entre Storj et index local, gestion des fichiers non-Aether (ignorés avec avertissement), interface React complète pour la gestion Storj (configuration, upload, download par chemin logique ou UUID, liste avec métadonnées, suppression), ajout automatique des fichiers chiffrés à l'index local après chiffrement, tous les tests intégraux Phase 1 + Phase 2 validés à 100% (workflow end-to-end, non-régression, persistance après redémarrage), **PHASE 3 FINALISÉE** : serveur Wayne (Node.js/TypeScript + PostgreSQL) créé et déployé sur VPS (72.62.59.152), schéma de base de données PostgreSQL créé (users, key_envelopes, refresh_tokens), API REST opérationnelle (authentification, gestion des enveloppes MKEK), service systemd configuré et actif, Nginx configuré comme reverse proxy (port 80), serveur accessible publiquement via HTTP, client Wayne intégré dans l'application React (authentification, sauvegarde/récupération MKEK), tous les tests d'intégration end-to-end validés (bootstrap avec sauvegarde MKEK sur Wayne, unlock avec récupération MKEK depuis Wayne, non-régression Phase 1 et Phase 2).
* **Travail Effectué (Storj Transparent)** : Migration Wayne ajoutant table `storj_buckets` pour stockage credentials chiffrés, service Storj créé pour création automatique de buckets Storj par utilisateur, API Wayne avec endpoints `/api/v1/storj-config` pour créer/récupérer config Storj automatiquement, création automatique de bucket Storj lors de l'inscription Wayne, client React intégrant récupération et configuration automatique Storj depuis Wayne, Dashboard simplifié avec suppression section Configuration Storj (géré automatiquement), chiffrement credentials Storj avec clé maître serveur, workflow simplifié à 2 étapes seulement (Wayne + Mot de passe maître), Storj complètement transparent pour l'utilisateur final.
* **Travail Effectué (Refresh Tokens)** : Modèle RefreshToken créé avec génération sécurisée (crypto.randomBytes, bcrypt), API Wayne avec endpoints `/api/v1/auth/refresh` et `/api/v1/auth/logout`, intégration dans `/login` et `/register` avec paramètre `remember_me` optionnel, client React avec stockage localStorage, restauration automatique de session au démarrage, option "Rester connecté" dans LoginPage avec checkbox, gestion des conflits de base de données avec commande `reset_local_database` et bouton de résolution dans l'interface.
* **Travail Effectué (UX Simplifiée)** : Refactorisation complète du Dashboard pour une expérience utilisateur simplifiée similaire aux services cloud (Google Drive, Dropbox), upload simplifié avec sélection de fichier et drag & drop (zone dédiée avec feedback visuel), suppression complète des sections Storj et Index manuelles (gestion 100% automatique en arrière-plan), tableau de fichiers moderne avec colonnes (icône type, nom avec extension, taille formatée, actions), actions simplifiées (icônes download/delete à côté de chaque fichier), chargement automatique des fichiers depuis Storj au montage (synchronisation transparente), chemin logique auto-généré depuis le nom du fichier (plus besoin de saisie manuelle), workflow simplifié à 2 actions seulement (upload via drag & drop ou sélection, download/delete via icônes), interface épurée et professionnelle avec animations et états de chargement.
* **Travail Restant (Prochaine Phase)** : Changement de mot de passe (fonctionnalité critique permettant de changer le mot de passe Wayne sans re-chiffrer les données grâce au MKEK), tests multi-appareils (synchronisation MKEK + Storj entre plusieurs machines), fonctionnalités avancées (métadonnées anonymisées sur Wayne), optimisation performances et scalabilité.

## 3. Non-Régression
* Tests initiaux Tauri (dev server) validés.
* Tests unitaires Rust du Crypto Core (`cargo test`) validés.
* Flux UI local (bootstrap/unlock) testé manuellement avec succès.
* Tests unitaires SQLCipher (`cargo test sqlcipher_index`) validés.
* Persistance des données du bootstrap et déverrouillage après redémarrage validés.
* Commandes d'index (ajout/liste/suppression) testées manuellement avec succès.
* Module storage (format Aether) compilé et tests unitaires validés (12/12 tests passent).
* Commandes de chiffrement/déchiffrement testées manuellement avec succès depuis l'interface React.
* Protection HMAC par entrée implémentée et testée (tests unitaires passent).
* Merkle Tree pour intégrité globale implémenté et testé (tests unitaires passent).
* Vérification d'intégrité testée manuellement depuis l'interface React avec succès.
* **PHASE 1 COMPLÈTE** : Tous les tests unitaires passent (18/18), conformité blueprint 100%.
* **PHASE 2 COMPLÈTE** : Intégration Storj DCS opérationnelle avec synchronisation automatique index local, tous les tests intégraux validés (configuration, upload, download, delete, nettoyage orphelins, workflow end-to-end, non-régression Phase 1, persistance après redémarrage).
* **PHASE 3 COMPLÈTE** : Serveur Wayne déployé et accessible publiquement via HTTPS (https://eather.io), certificat SSL Let's Encrypt installé et configuré, base de données PostgreSQL opérationnelle, API REST fonctionnelle, service systemd actif, Nginx configuré avec redirection HTTP→HTTPS, client Wayne intégré dans l'application React avec authentification et gestion MKEK, URL par défaut mise à jour pour HTTPS, gestion d'erreur réseau améliorée dans le client Wayne, scripts de diagnostic et configuration créés, connexion HTTPS validée et fonctionnelle, tous les tests d'intégration end-to-end validés (bootstrap avec sauvegarde MKEK sur Wayne, unlock avec récupération MKEK depuis Wayne, non-régression Phase 1 et Phase 2).
